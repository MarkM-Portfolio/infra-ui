/* Copyright IBM Corp. 2015  All Rights Reserved.                    */
define("dojo dojo/string dojo/_base/declare dojo/has dojo/dom-style dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/i18n!ic-core/widget/urlPreview/nls/URLPreview dojo/dom-attr dojo/i18n!ic-incontext/nls/socialInContextCoreStrings dojo/on dojo/text!ic-core/widget/urlPreview/templates/FallBackImage.html dojo/text!ic-incontext/videoPreview/templates/VideoPreview.html ic-core/auth ic-core/config/properties ic-core/url ic-core/widget/urlPreview/URLPreviewNode ic-incontext/util/VideoPlayerUtil ic-incontext/util/html ic-incontext/util/proxy ic-ui/util/Url net/jazz/ajax/xdloader".split(" "),
function(g,l,p,q,f,h,b,k,r,c,s,t,u,v,m,z,A,w,x,n,y,B,C){return p("com.ibm.social.incontext.videoPreview.VideoPreviewNode",w,{templateString:u,strings:r,incontext_strings:s,data:null,videoPlayer:null,isEE:null,constructor:function(a){},postCreate:function(){this.isEE=this.onSizeChange;this.data&&this.renderData(this.data);this.videoPlayer=new x;n.isHighContrast()&&(b.remove(this.highContrastThumbnailText,"lotusHidden"),b.remove(this.highContrastPlayText,"lotusHidden"),c.set(this.highContrastPlayText,
"innerHTML",this.strings.playVideo))},renderData:function(a){if(a&&a.title){var d=n.decodeHtml(a.title);c.set(this.domNode,"role","region");c.set(this.domNode,"aria-label",this.incontext_strings.VIDEO_PREVIEW.ARIA_VIDEO_PREVIEW+" "+d);this.connect(this.thumbnailContainer,"onmouseover",function(a){b.replace(this.playBtn,"otherHTML5Player16-play-overlay-sm-hover","otherHTML5Player16-play-overlay-sm")});this.connect(this.thumbnailContainer,"onmouseout",function(a){b.replace(this.playBtn,"otherHTML5Player16-play-overlay-sm",
"otherHTML5Player16-play-overlay-sm-hover")});b.remove(this.domNode,"lconnPreviewHidden");this.own(t(this.thumbnailContainer,"click","showMedia"));c.set(this.thumbnailContainer,"href","javascript:;");c.set(this.thumbnailContainer,"role","button");c.set(this.thumbnailContainer,"title",l.substitute(this.incontext_strings.VIDEO_PREVIEW.ARIA_VIDEO_TITLE,[d]));c.set(this.thumbnailContainer,"aria-label",this.incontext_strings.VIDEO_PREVIEW.ARIA_VIDEO_DOWNLOAD);a.image?this.setThumbnail(a.image):b.add(this.thumbnailContainer,
"videoPreviewNoThumbnail");a.filePageUrl===a.fileUrl&&g.removeAttr(this.titleNode.childNodes[0],"target");if(a.tagsTextNode||a.authorInfo)b.remove(this.fileMetaNode,"lotusHidden"),d=m.getUser()&&m.getUser().isExternal,a.authorInfo&&d&&b.add(this.authorNode,"lotusBold"),a.tagsTextNode&&(k.place(a.tagsTextNode,this.tagNode),b.remove(this.tagNode,"lotusHidden"))}},setThumbnail:function(a){8==q("ie")?(c.set(this.thumbnail,"src",a),f.set(this.thumbnail,"width","120px"),f.set(this.thumbnail,"height","120px"),
b.add(this.playBtn,"playBtnInIE8")):(f.set(this.thumbnailContainer,"background",'url("'+a+'") no-repeat 50% 50%'),f.set(this.thumbnailContainer,"backgroundSize","cover"))},showMedia:function(a){return this.showVideo(arguments)},showVideo:function(a){var d=y(this.data.fileUrl);b.add(this.leftPane,"lconnPreviewHidden");b.add(this.rightPane,"lconnPreviewHidden");var c=this.data.imageWidth?this.data.imageWidth:g.marginBox(this.domNode).w;this.isEE?(this.videoPlayer.playVideo(this.data.title,d,this.domNode,
c,this.data.imageHeight,this.data.maxHeight,this.onSizeChange,this.downloadFailed,this.data.prevId,this.data.nextId,this.data.context),a=h.hitch(this,function(){this.onSizeChange()}),setTimeout(a,500)):g.xhr("HEAD",{url:d,load:h.hitch(this,function(){this.videoPlayer.playVideo(this.data.title,d,this.domNode,c,this.data.imageHeight,this.data.maxHeight,this.onSizeChange,this.downloadFailed,this.data.prevId,this.data.nextId,!1)}),error:h.hitch(this,"downloadFailed",this.domNode,this.strings.cantPlayVideo)});
this.data.fileDetailsContainer&&b.remove(this.data.fileDetailsContainer,"lotusHidden")},downloadFailed:function(a,b){var e=l.substitute(v,{cantPlayVideo:b}),e=k.toDom(e);c.set(e,"tabindex","-1");k.place(e,a);dijit.focus(e)}})});
