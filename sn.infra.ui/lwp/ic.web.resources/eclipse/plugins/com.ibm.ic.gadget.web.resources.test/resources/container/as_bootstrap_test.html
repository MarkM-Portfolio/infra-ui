<!-- Copyright IBM Corp. 2015  All Rights Reserved.                    -->
<html><body><p>${head}
${script:com.ibm.lconn.gadget.resources.iRuntimeModule}
${script:com.ibm.lconn.gadget.container._Accessor}
${script:com.ibm.lconn.gadget.container._Handle}
${script:com.ibm.lconn.gadget.container._Container}
${script:com.ibm.lconn.gadget.container.iContainer2}
${script:com.ibm.lconn.gadget.test.lib.BootstrapAS}

<!-- Redirect to &render=test -->
<script type="text/javascript">	
	var loc = location + '';
	if (loc.indexOf('render=test') < 0) {
		if (loc.indexOf('?') > 0) {
			location = loc + "&render=test";
		}
		else {
			location = loc + "?render=test";
		}
	}
</script>

<script type="text/javascript">	
	dojo.require('lconn.core.config.services');
	dojo.require("com.ibm.oneui.util.proxy");
	dojo.require("lconn.core.url");
	
	var web_resources_url = lconn.core.config.services['webresources'].url;
	var page_url_dotdot_dotdot = lconn.core.url.parse(window.location.toString(), '../..').toString();
	page_url_dotdot_dotdot = page_url_dotdot_dotdot.substring(0, page_url_dotdot_dotdot.length - 1);
</script>

<script type="text/javascript">
	var mContainer = null;
	var mHandle = null;
	var mEEHandle = null;
	var iWidgetHandle = null;
	
	//dojo.registerModulePath("com.ibm.lconn.gadget", page_url_dotdot_dotdot);
</script>


<style>
#attach_point {
  width: 850px;
  height: 600px;
  max-height: 600px;
  overflow-y: auto;
  overflow-x: auto;
}
#ee_attach_point {
  width: 300px;
  height: 600px;
  overflow-y: auto;
  overflow-x: auto;	
}

.icTestGadgetUrl {
	width: 600px
}

#action_controls {
  width: 500px;
  height: 600px;
  overflow-y: auto;
  overflow-x: auto;
}
</style>


<script type="text/javascript">
	var eeDivId = 0;
	
	function load_widget() {
		//try {
			var def = window.bootstrapAS.getGadgetDef();
			if (mHandle) {
				mHandle.close();
				mHandle = null;
			}
							
			mHandle = mContainer.loadWidget(def);
		//} catch ( e ) {
		//	console.debug("Caught exception: " + e);
		//}
		
		return false;
	}
	
	function pre_load_widget() {
		//try {
			var def = window.bootstrapAS.getGadgetDef();
							
			mContainer.preloadWidgets([def]);
		//} catch ( e ) {
		//	console.debug("Caught exception: " + e);
		//}
		
		return false;
	}
	
	function refresh_widget() {
		if (mHandle) {
			mHandle.refresh();
		}
	}
	
	function close_widget() {
		if (mHandle) {
			mHandle.close();
		}
	}
	
	function parse_action() {
		return false;
	}
</script>
${endhead}
</p>
<h3>Container Testpage for ActivityStream gadget</h3>
<!-- BODY -->
<div id="bootstrapASForm"></div>
	
		<button onclick="pre_load_widget();" name="submitButton" value="submit">Preload Gadget (needed for actions)</button>
		<button onclick="load_widget();" name="submitButton" value="submit">Load Gadget</button>
		<button onclick="refresh_widget();">Refresh</button>
		<button onclick="close_widget();">Close</button>
		<br><br>
	   
<table style="border-width: 2px; border-spacing: 0px; border-style: outset; border-color: gray; border-collapse: collapse; background-color: white;"><tr>
<td valign="top" style="border-width: 1px; padding: 3px; border-style: inset; border-color: gray;">
	<h3>AS Attach Point</h3>
	<div id="attach_point">AS Goes Here...</div>
</td>
<td valign="top" style="border-width: 1px; padding: 3px; border-style: inset; border-color: gray;">
	<h3>EE Attach Point</h3>
	<div id="ee_attach_point" style="">EE Goes Here...</div>
</td>
<td valign="top" style="border-width: 1px; padding: 3px; border-style: inset; border-color: gray;">
   <div id="action_controls" style=""><h3>Actions</h3>
         <form name="actionsBootstrapper" id="actionsBootstrapper">
           <span style="display: inline-block;">Action input [Opt, JSON]:</span>
           <textarea type="text" id="actioninput" name="actioninput" style="width: 90%" rows="12">
{
 displayName:"Joe Bloggs1",
 emails: 
  [{
   primary:true, 
   type:"primary", 
   value:"JoeBloggs1@ipdorn2010.mul.ie.ibm.com"
  }],
 id:"urn:lsid:lconn.ibm.com:profiles.person:d79c7e40-709b-102f-9f3e-f6be80987c6a"
}
            </textarea>
            <br>
            </form>
            <h4>Action List (<button onclick="refresh_actions();">Refresh List</button>)</h4>
            <ul id="actionlist">
            </ul>
       <script type="text/javascript">
           var action_handles = [], do_action;
           var refresh_actions = function(){
             // first, clean up
             dojo.empty("actionlist");
             while(action_handles.length > 0) {
               dojo.disconnect(action_handles.pop());
             }
			mContainer.getCommonContainer().then(function(container) {
	             if(typeof do_action === "undefined") {
		           do_action = function() {
		             container.actions.runAction(this.id, dojo.fromJson(dojo.attr("actioninput", "value")));
		           }
	             }
	             var action_list = container.actions.getAllActions();
	             var action_node;
	             for(var i=0, l=action_list.length; i<l; i++) {
	               action_node = dojo.create("li", {"innerHTML":"<button>" + action_list[i].id + ""}, "actionlist");
	               action_handles.push(dojo.connect(action_node, "onclick", action_list[i], do_action));
	             }
             });
           }
       </script>
    </div>
</td>
</tr>
</table>
	
	<script type="text/javascript">
		var eeDivId = 0;
		dojo.addOnLoad(function() {
			window.bootstrapAS = new com.ibm.lconn.gadget.test.lib.BootstrapAS({}, "bootstrapASForm");
			bootstrapAS.startup();
			
			mContainer = com.ibm.lconn.gadget.container.iContainer2;			
			mContainer.init();
			mContainer.views.registerCreateElementForEEHandler(
				"slideout", 
				function() {
					eeDivId += 1;
					return dojo.create("div", { id: "eeDivId" + eeDivId }, dojo.byId("ee_attach_point"));
				}, 
				function(site){
					mContainer.getCommonContainer().then(function(container) {
						container.closeGadget(site);
						dojo.destroy("eeDivId" + eeDivId);
					});
				}
			);
			if ( window.location.search.indexOf("noauto") == -1 ) {
				load_widget();
			}
		});
	</script>

${end}
</body></html>
