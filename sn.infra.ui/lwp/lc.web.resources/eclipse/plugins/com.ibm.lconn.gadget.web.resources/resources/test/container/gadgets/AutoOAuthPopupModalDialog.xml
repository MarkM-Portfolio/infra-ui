<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright IBM Corp. 2012, 2015  All Rights Reserved.              -->

<Module>
	<ModulePrefs title="Auto OAuth Modal Dialog Popup" description="Auto OAuth Modal Popup Dialog Test"
		height="400" width="500">
		<Require feature="open-views" />
		<Optional feature="cre.services.oauth.Popup"/>	
	</ModulePrefs>
	<Content type="html" view="embedded, default">
<![CDATA[
	<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">   

	<script type="text/javascript">	
		function initSecondAuth(){
			var $ = function(id){
				return document.getElementById(id);
			};

			var extraAutoAuthComplete = $("extraAutoAuthComplete");
			
			var onClose = function(){
				extraAutoAuthComplete.style.display="";
			};
			
			var popup = new gadgets.oauth.Popup(
				gadgets.views.getParams().popupUrl || "/connections/resources/web/com.ibm.lconn.gadget/test/container/auto_oauth_popup.html?render=test&debug=true&oneui=3&_oauth_client_auto_authorize=true",
				"height=500,width=500",
				null,
				onClose
			);
			
			if(popup.renderComplete)
				popup.renderComplete();
		}
	
	
		function init(){
			var $ = function(id){
				return document.getElementById(id);
			};
			var authLink = $("authLink");
			var authDoneLink = $("authDoneLink");
			var authComplete = $("authComplete");
			
			var onOpen = function(){
				authLink.style.display = "none";
				authDoneLink.style.display = "";
			};
			
			var onClose = function(){
				authDoneLink.style.display="none";
				authComplete.style.display="";
			};
			
			var popup = new gadgets.oauth.Popup(
				gadgets.views.getParams().popupUrl || "/connections/resources/web/com.ibm.lconn.gadget/test/container/auto_oauth_popup.html?render=test&debug=true&oneui=3&_oauth_client_auto_authorize=true",
				"height=500,width=500",
				onOpen,
				onClose
			);
			
			authLink.onclick = popup.createOpenerOnClick();
			authDoneLink.onclick = popup.createApprovedOnClick();     	
			if(popup.renderComplete)
				popup.renderComplete();
				
			initSecondAuth();
		}
		
		gadgets.util.registerOnLoadHandler(init);
		
	</script>
   	     
	 <div id="hello">
	 	<h3>Auto OAuth Test</h3>
		<div>
		<a id="authLink" href="javascript:;"> Authorize Popup</a>
		<a id="authDoneLink" href="javascript:;" style="display:none" > Manually Assert Authorization Done</a>
		<span id="authComplete" style="display:none"> Auth Completed</span>
		</div>
		<div>
		<span id="extraAutoAuthComplete" style="display:none">Second auto auth complete</span>
		</div>
	 </div>
  ]]></Content>
</Module>
