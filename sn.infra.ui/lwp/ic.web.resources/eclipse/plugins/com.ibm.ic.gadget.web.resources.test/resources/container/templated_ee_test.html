<!-- Copyright IBM Corp. 2015  All Rights Reserved.                    -->
<html><body><p>${head}
${script:com.ibm.lconn.gadget.resources.iRuntimeModule}
${script:com.ibm.lconn.gadget.container._Accessor}
${script:com.ibm.lconn.gadget.container._Handle}
${script:com.ibm.lconn.gadget.container._Container}
${script:com.ibm.lconn.gadget.container.iContainer2}

<!-- Redirect to &render=test -->
<script type="text/javascript">	
	var loc = location + '';
	if (loc.indexOf('render=test') < 0) {
		if (loc.indexOf('?') > 0) {
			location = loc + "&render=test";
		}
		else {
			location = loc + "?render=test";
		}
	}
</script>

<script type="text/javascript">	
	dojo.require('lconn.core.config');
	dojo.require('lconn.core.config.services');
	dojo.require("com.ibm.oneui.util.proxy");
	dojo.require("lconn.core.url");
	
	var web_resources_url = lconn.core.config.services['webresources'].url;
	var page_url_dotdot_dotdot = lconn.core.url.parse(window.location.toString(), '../..').toString();
	page_url_dotdot_dotdot = page_url_dotdot_dotdot.substring(0, page_url_dotdot_dotdot.length - 1);
	
</script>

<script type="text/javascript">
	var mContainer = null;
	var mHandles = [];
	var count = 0;
	
	//dojo.registerModulePath("com.ibm.lconn.gadget", page_url_dotdot_dotdot);
</script>


<style>
#ee_attach_point1 {
  width: 500px;
  height: 100px;
}

#ee_attach_point2 {
  width: 500px;
  height: 100px;
}
</style>

${endhead}

</p><h1>Showcases the Connections EE gadget caching template. </h1>
	<h2>EE Template Test</h2>
	<div>
	<h3> Loads a gadget twice to demonstrate the use of the shared resource caching opensocial template.</h3>
	</div>

<!-- BODY -->
<table width="100%"><tr><td>	
</td></tr><tr>
<td valign="top">
	<script type="text/javascript">
		function load_ee_widgets(definitionUrl, context, passParams) {
			com.ibm.cre.iRuntime.getCommonContainer().renderDebug_ = true;
			var eeContext;
			if ( dojo.trim(context).charAt(0) == '{' ) {
				eeContext = dojo.fromJson(context);
			} else  {
				eeContext = context;
			}
			
			var attach1,attach2;
			attach1 = dojo.byId("ee_attach_point1");
			attach2 = dojo.byId("ee_attach_point2");
			
			attach1.innerHTML = attach2.innerHTML = '';


			var def = {
					definitionUrl: definitionUrl,
					componentType : "gadget",
					instanceData : {
						renderParams : {
						},
						eeDataModel : {
							context : eeContext
						}
					},
					callback: function () {
						console.debug("bootstrap_test - gadget rendered")
					}
			};
			
			var viewParams;
			if(passParams){
				viewParams = {
					webResourcesUrl: lconn.core.config.services.webresources.url,
					versionStamp: lconn.core.config.versionStamp
				};
			}
			def.instanceData.viewParams = viewParams;
			mHandles = [];
			
			var id = 'ee_elm_' + count++;
			dojo.create('div', { id : id }, attach1);
			def.placement = id;
					
			mHandles.push(mContainer.loadWidget(def));

			id = 'ee_elm_' + count++;
			dojo.create('div', { id : id }, attach2);
			def.placement = id;

			mHandles.push(mContainer.loadWidget(def));
		}
		
		function refresh_ee_widgets() {
			dojo.forEach(mHandles, function(handle){
				handle.refresh();	
			});
		}
			
		function close_ee_widgets() {
			dojo.forEach(mHandles, function(handle){
				handle.unload();	
			});
		}
		
	</script>

	<div id="eeBootstrapForm1">
		<form name="eeGadgetBootstrapper1" id="eeGadgetBootstrapper1">
			Gadget Url:
			<input type="text" id="eeGadget1" name="eeGadget1" style="width: 60%"><br>
	        Context:
	        <input type="text" id="eeContext1" name="eeContext1" style="width: 60%" value="Some context goes here">
	        <div>
	        	<label for="passParams"> Pass view params:</label> <input id="passParams" type="checkbox"> 
	        </div>
		</form>
		<script>
			function preFillGadget1() {
				var gadgetUrl = lconn.core.url.parse(location.toString(), 'gadgets/EETemplatedHelloWorld.xml').toString();
				dojo.byId('eeGadget1').value = gadgetUrl;
				dojo.byId('eeContext1').value = 'some context goes here';
			}
			
		</script>
		<button onclick="preFillGadget1();">Pre-fill Hello World</button>
		<br><br>
		<button onclick="load_ee_widgets(dojo.byId('eeGadget1').value,  dojo.byId('eeContext1').value, dojo.byId('passParams').checked);">Load EE Gadgets</button>
		<button onclick="refresh_ee_widgets();">Refresh</button>
		<button onclick="close_ee_widgets();">Close</button>
	</div>   
	
	<h3>EE Attach Point 1</h3>
	<div id="ee_attach_point1" style="">EE Gadget 1 Goes Here...</div>
</td>
<td>	
	<h3>EE Attach Point 2</h3>
	<div id="ee_attach_point2" style="">EE Gadget 2 Goes Here...</div>
</td>
</tr>

</table>
	
<script type="text/javascript">
	dojo.addOnLoad(function() {
		mContainer = com.ibm.lconn.gadget.container.iContainer2;			
		mContainer.init();
	});
</script>

${end}
</body></html>
