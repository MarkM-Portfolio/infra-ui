/* Copyright IBM Corp. 2015  All Rights Reserved.                    */
define("dojo dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/topic ic-as/constants/events ic-as/extension/interfaces/IExtension ic-as/item/StatusNewsItem ic-core/DialogUtil".split(" "),function(m,n,c,h,k,e,f,p,q,l){return n("com.ibm.social.as.lconn.extension.MicroblogDeletionExtension",p,{statusNewsItemClass:null,statusNewsItemPrototype:null,inlineCommentClass:null,opensocialUri:lconn.core.url.getServiceUrl(lconn.core.config.services.opensocial).uri,createMessageEvent:f.CREATEMESSAGE,
constructor:function(){this.statusNewsItemClass=q;this.statusNewsItemPrototype=this.statusNewsItemClass.prototype;this.inlineCommentClass=com.ibm.social.as.item.comment.InlineComment},onLoad:function(){c.extend(this.statusNewsItemClass,{isXDisplayed:this.isMicroblogXDisplayed,onDeleteClicked:this.onMicroblogDeleteClicked,deleteMicroblog:this.deleteMicroblog,opensocialUri:this.opensocialUri,createMessageEvent:this.createMessageEvent,cancelDelete:this.cancelDelete});c.extend(this.inlineCommentClass,
{isXDisplayed:this.isMicroblogCommentXDisplayed,onDeleteClicked:this.onMicroblogCommentDeleteClicked,deleteMicroblog:this.deleteMicroblog,opensocialUri:this.opensocialUri,createMessageEvent:this.createMessageEvent,cancelDelete:this.cancelDelete})},onUnload:function(){delete this.statusNewsItemPrototype.isXDisplayed;delete this.statusNewsItemPrototype.onDeleteClicked;c.extend(this.inlineCommentClass,{isXDisplayed:function(){return!1},onDeleteClicked:function(){},handleCancelDelete:function(){}})},
isMicroblogXDisplayed:function(){var a=this.configManager.getUserInfoId(),b="";this.newsData&&"note"===this.newsData.getActivityType()&&(b=this.newsData.getBoardUserId());b&&(b=this.getConnectionsUserId(b));var c=this.getConnectionsUserId(this.newsData.getActivityAuthorId()),g=this.configManager.isUserNewsAdmin();return c===a||b&&b===a||g},onMicroblogDeleteClicked:function(){var a=activityStreamAbstractHelper.getMBDeleteUrl(this.newsData.getActivityId()),b=k.create("div",{innerHTML:this.strings.statusRemoveConfirmMessageText});
h.add(b,"confirmDialogMessageNode");this.dialogBundle=l.popupForm(this.strings.statusRemoveText,b,this.strings.statusRemoveConfirmText,this.strings.statusRemoveCancelText,c.hitch(this,this.deleteMicroblog,a,this.strings.statusRemoveConfirmationMsg,this.strings.statusRemoveErrorMsg),c.hitch(this,this.cancelDelete));activityStreamAbstractHelper.repositionDialog(this.domNode)},isMicroblogCommentXDisplayed:function(){var a=this.newsItem;if(!a.newsData||"note"!==a.newsData.getActivityType())return!1;a=
"";this.newsItem&&this.newsItem.newsData&&"note"===this.newsItem.newsData.getActivityType()&&(a=this.newsItem.newsData.getBoardUserId());a&&(a=this.getConnectionsUserId(a));var b=this.configManager.getUserInfoId(),c=this.getConnectionsUserId(this.newsItem.newsData.getActivityAuthorId()),g=this.configManager.isUserNewsAdmin();return b==c||b===(this.comment&&this.comment.author&&this.getConnectionsUserId(this.comment.author.id))||a===b||g},onMicroblogCommentDeleteClicked:function(){var a=document.activeElement,
b=activityStreamAbstractHelper.getMBDeleteCommentUrl(this.newsItem.newsData.getActivityId(),this.comment.id),d=k.create("div",{innerHTML:this.strings.commentRemoveConfirmMessageText});h.add(d,"confirmDialogMessageNode");this.dialogBundle=l.popupForm(this.strings.commentRemoveText,d,this.strings.commentRemoveConfirmText,this.strings.commentRemoveCancelText,c.hitch(this,this.deleteMicroblog,b,this.strings.commentRemoveConfirmationMsg,this.strings.commentRemoveErrorMsg),c.hitch(this,this.cancelDelete,
a));activityStreamAbstractHelper.repositionDialog(this.domNode)},deleteMicroblog:function(a,b,d){activityStreamAbstractHelper.xhrDelete({url:a,headers:{"Content-Type":"application/json"},handleAs:"json",load:c.hitch(this,function(){m.fadeOut({node:this.domNode,onEnd:c.hitch(this,function(){this.destroyRecursive();e.publish(f.NEWSITEMDELETE)})}).play();b&&e.publish(this.createMessageEvent,b,"CONFIRM",!0)}),error:c.hitch(this,function(a){console.error("MicroblogDeletionExtension could not delete microblog: %o",
a);d&&e.publish(this.createMessageEvent,d,"ERROR",!0)})});this.dialogBundle.hide()},cancelDelete:function(a){this.dialogBundle.hide();e.publish(f.ITEMGOTFOCUS,this,!0,a)}})});
