/* Copyright IBM Corp. 2015  All Rights Reserved.                    */
define("dojo dojo/dom-construct dojo/cookie dojo/_base/array dojo/_base/window dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has dojo/query dojo/topic ic-core/config/services ic-core/config/properties ic-core/auth ic-ee/EventRegistry ic-ee/util/OAuthHelper ic-ee/util/misc ic-eeconfig/config ic-incontext/NetworkDojo ic-incontext/NetworkOS ic-incontext/gadget/Bootstrap ic-incontext/util/auth".split(" "),function(s,w,x,t,y,e,l,z,m,A,d,B,C,D,E,n,F,u,G,H,I,k){(function(){var h=com.ibm.social.ee.gadget.Bootstrap,
p=["waiting","needAuth","gadgetBody"],v=null;e.mixin(h,I);e.mixin(h,{DEFAULT_TRACE:"com.ibm.social.incontext.NetworkOS~com.ibm.social.ee.widget.EELoader~com.ibm.social.ee.widget.HtmlJsonEELoader~com.ibm.social.ee.widget.AuthUserEELoader",adjustHeight:function(a){gadgets.window.adjustHeight(a)},initializeNetwork:function(a){function b(a,b){return a in b?b[a]:a.toLowerCase()in b?b[a.toLowerCase()]:null}function f(a,c,f){console.log("rc = ",c,", headers = ",f);if(401===c||302===c||m("ie")&&0===c)return!0;
a=b("Content-Type",f);return/^text\/html/.exec(a)&&200<=c&&300>c&&204!==c&&"false"===b("X-LConn-Auth",f)?!0:!1}shindig.auth.getSecurityToken();var g=gadgets.util.hasFeature("smartcloud3"),c="MultiTenant"===C.DeploymentModel,d=e.getObject("com.ibm.social.eeconfig.config.isAnonymousAllowed"),q=g||c||!d;this.isAnonymous=!1;c=a.eventType;g&&c&&("profiles.colleague.created"===c||"profiles.notification.notify"===c)&&(c="generic");c=E.getClass(c);this.clz=e.getObject(c);this.useOAuth=g?!1:"false"!==gadgets.views.getParams().useOAuth;
c={};this.useOAuth?(c[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME]="connections_service",c[gadgets.io.RequestParameters.AUTHORIZATION]=gadgets.io.AuthorizationType.OAUTH2):(c[gadgets.io.RequestParameters.AUTHORIZATION]=gadgets.io.AuthorizationType.SSO,c[gadgets.io.RequestParameters.SSO_REAUTH_DETECTOR]=f);this.network=new (g?G:H)({oauth:this.useOAuth,anonymous:this.isAnonymous,oAuthDefaults:c,onAuthApproval:function(a,b,c){t.forEach(A(".eeOAuthImg"),function(a){n.addImgSrc(a)});var f=n.createAuthLink(l.byId("oAuthQuestion")),
d=n.createAuthDoneLink(l.byId("oAuthQuestionWait"));a=new gadgets.oauth.Popup(a,"height=600,width=800",function(){h.showOne(p,"waiting")},function(){h.showOne(p,"gadgetBody");b&&b(c)});f.onclick=a.createOpenerOnClick();d.onclick=a.createApprovedOnClick();h.showOne(p,"needAuth");a.renderComplete&&a.renderComplete()},onSSOReauth:function(){(new cre$.sso.ReauthHandler).createHandlerOnClick()()}});g&&this.shouldUseXMethodOverride(a)&&(this.network.xmethodoverride=!0);q&&(this.network.anonymousNotAllowed=
!0);var r=this;k.hasCurrentViewer()||(a=lconn.core.url.getServiceUrl(B.opensocial).uri+(this.useOAuth?"/oauth":"")+"/rest/people/@me/@self",this.network.getJson({url:a,handle:function(a){(a=k.parseUserFromOpensocialResponse(a))&&k.setCurrentViewer(a);r._updateAccessProperties(q,g)},error:function(a){r._updateAccessProperties(q,g)}}));D.setAuthCheck(function(){return!r.isAnonymous})},_updateAccessProperties:function(a,b){var f=k.hasCurrentViewer();this.isAnonymous=a?!1:!f;this.useOAuth=b?!1:!this.isAnonymous&&
"false"!==gadgets.views.getParams().useOAuth;this.network.oauth=this.useOAuth;(this.network.anonymous=this.isAnonymous)&&this.network.oAuthDefaults&&(this.network.oAuthDefaults[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME]=null,this.network.oAuthDefaults[gadgets.io.RequestParameters.AUTHORIZATION]=null,this.network.oAuthDefaults[gadgets.io.RequestParameters.AUTHORIZATION]=null,this.network.oAuthDefaults[gadgets.io.RequestParameters.SSO_REAUTH_DETECTOR]=null)},shouldUseXMethodOverride:function(a){return a&&
a.eventType?0===a.eventType.indexOf("files."):!1},initializeKeyHandlers:function(){gadgets.util.hasFeature("com.ibm.connections.ee")&&(d.subscribe("lconn/core/mentions/startTrack",function(){com.ibm.connections.ee.preventCloseOnEscape()}),d.subscribe("lconn/core/mentions/stopTrack",function(a){com.ibm.connections.ee.allowCloseOnEscape(a&&"keypress"===a.type&&0===a.charCode&&a.keyCode===s.keys.ESCAPE)}),d.subscribe("lconn/core/mentions/focus",function(a){a&&com.ibm.connections.ee.preventCloseOnEscape()}),
d.subscribe("lconn/core/mentions/blur",function(){com.ibm.connections.ee.allowCloseOnEscape()}))},onGadgetLoaded:function(a){this.onSizeChange();a&&a();s.config.isDebug&&console.log((new Date).getTime()+" -- Gadget finished loading")},isResizingEnabled:function(){if(!("resizingEnabled"in this)){var a=x("_eePopupResizingEnabled"),b=u.popupResizing;a&&(b="true"===a);this.resizingEnabled=b}return this.resizingEnabled},calculateHeight:function(){var a=0;t.forEach(y.body().childNodes,function(b){b.getBoundingClientRect&&
(b=z.position(b,!0),a=Math.max(a,Math.floor(b.y+b.h)))});return a},onSizeChange:function(a){var b=null;a&&!isNaN(a)?(b=this.calculateHeight(),this.adjustHeight(a>b?a:b)):m("ie")&&this.isResizingEnabled()?(b=this.calculateHeight(),a=8>=m("ie")?20:5,this.adjustHeight(b+a)):this.adjustHeight()},onLoadGadgetComplete:function(a){v=function(){a.onLoadedBody&&eval(a.onLoadedBody);if(a.portletUrlSettings){var b=new com.ibm.social.as.portlet.PortletUrlUtil(a.portletUrlSettings);b.updateEEUrls(l.byId("gadgetBody"),
a);d.subscribe("com/ibm/social/ee/data/loaded",e.hitch(b,b.updateEEUrls,"gadgetBody",a));d.subscribe("com/ibm/social/ee/comment/afterCreated",e.hitch(b,b.updateEEUrls,"gadgetBody",a));d.subscribe("com/ibm/social/ee/comment/afterUpdated",e.hitch(b,b.updateEEUrls,"gadgetBody",a))}F.addMessageToNewWindowLinks()};var b=null;a.openSocial&&a.openSocial.connections&&a.openSocial.connections.rollupUrl&&(b=a.openSocial.connections.rollupUrl);b&&(a.rollupUrl=b);b={isGadget:!0,blankGif:window.djConfig.blankGif,
context:a,onLoaded:e.hitch(this,this.onGadgetLoaded,v),onSizeChange:e.hitch(this,this.onSizeChange),network:this.network,oauth:this.useOAuth,anonymous:this.isAnonymous};new this.clz(b,"gadgetBody")},setTitle:function(a){if(gadgets.util.hasFeature("settitle")){var b=function(a){if(!a)return"";for(var d=[],c=0,e;e=a.childNodes[c];c++)3===e.nodeType?d.push(e.nodeValue):1===e.nodeType&&"none"!==e.style.display&&d.push(b(e));return 0<d.length?d.join(""):""};a.eventTitle&&(a=w.create("span",{innerHTML:a.eventTitle}),
a=b(a),gadgets.window.setTitle(a))}},getClassesToTrace:function(){var a=u.jsTrace;a||(a=this.DEFAULT_TRACE);return a},getBodyClasses:function(){var a="lotusui30 lotusui30_fonts lotusui30_layout lotusui30_body lotusui30dojo";gadgets.views.getParams().hideBodyOverflow&&(a+=" eeHideBodyOverflow");return a}});(function(){if(gadgets.util.hasFeature("ibm.connections.ee")){var a=ibm.connections.ee;d.subscribe("com/ibm/social/ee/event/scrollTop",function(){a.scrollToTop()});d.subscribe("com/ibm/social/ee/event/scrollBottom",
function(){a.scrollToBottom()});d.subscribe("com/ibm/social/ee/event/modified",function(b){a.setDirty(b.modified)});d.subscribe("com/ibm/social/ee/event/addentry",function(b,d){a.onActivityEntryUpdate(b,d)})}})()})();return com.ibm.social.ee.gadget.Bootstrap});
